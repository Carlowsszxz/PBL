<!DOCTYPE html>
<html lang="en" class="transition-colors duration-300">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="images/UMak_Logo_Registered.png">
    <title>Admin Dashboard - University of Makati</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles/login.css">
    <link rel="stylesheet" href="styles/setup.css">
    <style>
        [data-page="setup"] .bg-indigo-600 {
            background-color: #0e163e !important
        }

        [data-page="setup"] .hover\:bg-indigo-700:hover {
            background-color: #121c54 !important
        }

        [data-page="setup"] .text-indigo-600 {
            color: #0e163e !important
        }

        [data-page="setup"] .hover\:text-indigo-700:hover {
            color: #121c54 !important
        }

        [data-page="setup"] .focus\:border-indigo-500:focus {
            border-color: #0e163e !important
        }

        [data-page="setup"] .focus\:ring-indigo-200:focus {
            box-shadow: 0 0 0 3px rgba(14, 22, 62, .2) !important
        }

        [data-page="setup"] .sidebar-nav-item.active {
            background: rgba(14, 22, 62, .15) !important;
            border-color: rgba(14, 22, 62, .4) !important;
            color: #0e163e !important
        }

        [data-page="setup"] .header-trigger-icon {
            color: #0e163e !important
        }

        [data-page="setup"] .bg-gradient-to-br {
            background: linear-gradient(135deg, #0e163e 0%, #121c54 100%) !important
        }

        [data-page="setup"] .bg-gradient-to-r {
            background: linear-gradient(90deg, #0e163e 0%, #121c54 100%) !important
        }

        [data-page="setup"] .from-indigo-600 {
            background-color: #0e163e !important
        }

        [data-page="setup"] .to-pink-400 {
            background-color: #121c54 !important
        }

        [data-page="setup"] .from-green-500 {
            background-color: #0e163e !important
        }

        [data-page="setup"] .to-indigo-500 {
            background-color: #121c54 !important
        }

        [data-page="setup"] .from-pink-600 {
            background-color: #0e163e !important
        }

        [data-page="setup"] .to-indigo-400 {
            background-color: #121c54 !important
        }

        [data-page="setup"] .from-pink-500 {
            background-color: #0e163e !important
        }

        [data-page="setup"] .to-indigo-800 {
            background-color: #121c54 !important
        }

        [data-page="setup"] .from-emerald-400 {
            background-color: #0e163e !important
        }

        [data-page="setup"] .from-pink-400 {
            background-color: #0e163e !important
        }

        .card-fadein {
            opacity: 0;
            animation: simplefadein 0.3s 0.1s ease-out forwards;
        }

        @keyframes simplefadein {
            to {
                opacity: 1;
            }
        }

        /* Scrollable container styles */
        #occupancyData,
        #noiseData {
            max-height: 500px;
            overflow-y: auto;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        #announcementsList {
            max-height: 600px;
            overflow-y: auto;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        /* Custom scrollbar styling */
        #occupancyData::-webkit-scrollbar,
        #noiseData::-webkit-scrollbar,
        #announcementsList::-webkit-scrollbar {
            width: 8px;
        }

        /* Noise Gauge Bar Styles */
        .noise-gauge-container {
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px;
            border: 1px solid #86efac;
        }

        .noise-gauge-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .noise-db-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: #166534;
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .noise-db-unit {
            font-size: 1.2rem;
            color: #4b5563;
        }

        .noise-gauge-bar-wrapper {
            position: relative;
            width: 100%;
            height: 32px;
            background: #e5e7eb;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .noise-gauge-bar {
            height: 100%;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.5s ease;
            border-radius: 16px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .noise-gauge-bar-label {
            color: white;
            font-size: 0.875rem;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            white-space: nowrap;
        }

        .noise-gauge-bar.level-safe {
            background: linear-gradient(90deg, #10b981, #34d399);
        }

        .noise-gauge-bar.level-warning {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
        }

        .noise-gauge-bar.level-alert {
            background: linear-gradient(90deg, #ef4444, #f87171);
        }

        .noise-gauge-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.75rem;
            color: #6b7280;
        }

        .noise-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .noise-info-item {
            padding: 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #d1d5db;
        }

        .noise-info-label {
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 4px;
        }

        .noise-info-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1f2937;
        }

        .noise-status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        /* Outline button style (no fill, only border) */
        .btn-outline {
            background: transparent;
            border: 1px solid #4f46e5; /* indigo-600 */
            color: #4f46e5;
            border-radius: 8px;
            transition: background-color .18s ease, color .18s ease, box-shadow .18s ease;
        }

        .btn-outline:hover {
            background: rgba(79,70,229,0.06);
            color: #3730a3; /* slightly darker on hover */
        }

        .noise-status-badge.safe {
            background: #d1fae5;
            color: #065f46;
        }

        .noise-status-badge.warning {
            background: #fed7aa;
            color: #92400e;
        }

        .noise-status-badge.alert {
            background: #fee2e2;
            color: #991b1b;
        }

        @media (max-width: 640px) {
            .noise-db-display {
                font-size: 2rem;
            }

            .noise-gauge-bar-wrapper {
                height: 28px;
            }

            .noise-info-grid {
                grid-template-columns: 1fr;
            }
        }

            background: linear-gradient(135deg, rgba(30, 45, 30, 0.6) 0%, rgba(20, 35, 25, 0.6) 100%);
            border: 1px solid rgba(134, 239, 172, 0.2);
        }

            color: #86efac;
        }

            color: #9ca3af;
        }

            background: rgba(55, 65, 81, 0.5);
        }

            color: #9ca3af;
        }

            background: rgba(31, 41, 55, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

            color: #9ca3af;
        }

            color: #e5e7eb;
        }

            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
        }

            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }

            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

            background: rgba(16, 185, 129, 0.15) !important;
        }

            background: rgba(245, 158, 11, 0.15) !important;
        }

            background: rgba(239, 68, 68, 0.15) !important;
        }

            border-color: rgba(16, 185, 129, 0.3) !important;
        }

            border-color: rgba(245, 158, 11, 0.3) !important;
        }

            border-color: rgba(239, 68, 68, 0.3) !important;
        }

            color: #d1d5db !important;
        }

            color: #d1d5db !important;
        }

            background: rgba(55, 65, 81, 0.5);
        }

            background: #8b5cf6;
            border: 2px solid rgba(139, 92, 246, 0.5);
        }

            background: #8b5cf6;
            border: 2px solid rgba(139, 92, 246, 0.5);
        }

            background: rgba(55, 65, 81, 0.8);
        }

            background: rgba(55, 65, 81, 0.8);
        }

            background: rgba(31, 41, 55, 0.5);
            border-color: rgba(255, 255, 255, 0.2);
        }

            background: #8b5cf6;
            border-color: #8b5cf6;
        }

            background: rgba(0, 0, 0, 0.8) !important;
        }

            background: rgba(31, 41, 55, 0.95) !important;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6) !important;
        }

            background: linear-gradient(135deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.8) 100%) !important;
            border-bottom: 1px solid rgba(75, 85, 99, 0.5) !important;
        }

            background: rgba(31, 41, 55, 0.95) !important;
            color: #e5e7eb !important;
        }

            background: rgba(17, 24, 39, 0.8) !important;
            border-top: 1px solid rgba(75, 85, 99, 0.5) !important;
        }

            background: rgba(55, 65, 81, 0.5) !important;
            border-color: rgba(75, 85, 99, 0.5) !important;
            color: #e5e7eb !important;
        }

            border-color: #8b5cf6 !important;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3) !important;
        }

            border-color: #8b5cf6 !important;
            background: rgba(139, 92, 246, 0.2) !important;
        }

            color: #e5e7eb !important;
        }

            background: rgba(55, 65, 81, 0.5) !important;
            border-color: rgba(75, 85, 99, 0.5) !important;
            color: #e5e7eb !important;
        }

            border-color: #8b5cf6 !important;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2) !important;
        }

            color: rgba(156, 163, 175, 0.8) !important;
        }

            background: rgba(17, 24, 39, 0.8) !important;
            border-color: rgba(75, 85, 99, 0.5) !important;
        }

            background: rgba(31, 41, 55, 0.5) !important;
            border-bottom: 1px solid rgba(75, 85, 99, 0.3) !important;
        }

            background: rgba(55, 65, 81, 0.7) !important;
        }

            color: #e5e7eb !important;
        }

            color: #9ca3af !important;
        }

            background: rgba(239, 68, 68, 0.2) !important;
            color: #fca5a5 !important;
        }

            background: rgba(16, 185, 129, 0.2) !important;
            color: #6ee7b7 !important;
        }

            color: #9ca3af !important;
        }

            border-color: rgba(75, 85, 99, 0.5) !important;
            border-top-color: #8b5cf6 !important;
        }

            background: rgba(55, 65, 81, 0.8) !important;
            color: #e5e7eb !important;
        }

            background: rgba(75, 85, 99, 0.8) !important;
        }

            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%) !important;
        }

            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.5) !important;
        }

            background: rgba(31, 41, 55, 0.95) !important;
            border-color: #8b5cf6 !important;
        }

            background: #8b5cf6 !important;
        }

            background: rgba(31, 41, 55, 0.98) !important;
            border-color: rgba(75, 85, 99, 0.5) !important;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4), 0 8px 24px rgba(0, 0, 0, 0.3) !important;
        }

            background: rgba(17, 24, 39, 0.5) !important;
        }

            background: rgba(75, 85, 99, 0.8) !important;
        }

            background: rgba(107, 114, 128, 0.8) !important;
        }

            background: rgba(31, 41, 55, 0.98) !important;
            border-color: rgba(75, 85, 99, 0.5) !important;
        }

            color: #e5e7eb !important;
        }

            background-color: rgba(55, 65, 81, 0.3) !important;
        }

            color: #e5e7eb !important;
        }

            background: rgba(55, 65, 81, 0.5) !important;
            border-color: rgba(75, 85, 99, 0.5) !important;
            color: #e5e7eb !important;
        }

            border-color: #8b5cf6 !important;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2) !important;
        }

            background: rgba(31, 41, 55, 1) !important;
            color: #e5e7eb !important;
        }

            color: rgba(156, 163, 175, 0.5) !important;
        }

            background: rgba(55, 65, 81, 0.5) !important;
            border-color: rgba(75, 85, 99, 0.5) !important;
        }

            color: #000000 !important;
        }

            color: #000000 !important;
        }

            background: rgba(55, 65, 81, 0.6) !important;
            border-color: rgba(75, 85, 99, 0.5) !important;
            color: #e5e7eb !important;
        }

            border-color: #8b5cf6 !important;
            background: rgba(75, 85, 99, 0.8) !important;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.2) !important;
        }

            border-color: #8b5cf6 !important;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%) !important;
            color: white !important;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4) !important;
        }

            background: linear-gradient(135deg, #9d6dff 0%, #8b5cf6 100%) !important;
            box-shadow: 0 6px 16px rgba(139, 92, 246, 0.5) !important;
        }

            background: rgba(55, 65, 81, 0.8) !important;
            color: #e5e7eb !important;
            border: 1px solid rgba(75, 85, 99, 0.5) !important;
        }

            background: rgba(75, 85, 99, 0.9) !important;
            border-color: #8b5cf6 !important;
        }

            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%) !important;
        }

            background: linear-gradient(135deg, #9d6dff 0%, #8b5cf6 100%) !important;
        }

            color: #9ca3af !important;
        }

            color: #e5e7eb !important;
        }

            background: rgba(59, 130, 246, 0.15) !important;
            border-color: rgba(59, 130, 246, 0.3) !important;
        }

            color: #93c5fd !important;
        }

            background: rgba(31, 41, 55, 0.95) !important;
            border-color: rgba(75, 85, 99, 0.5) !important;
        }

            background: rgba(55, 65, 81, 0.95) !important;
            border-color: #8b5cf6 !important;
        }

        /* Student Assignment Modal Styles */
        .assign-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.65);
            /* Removed backdrop-filter for performance */
            z-index: 1000;
            animation: fadeIn 0.2s ease;
        }

        .assign-modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .assign-modal {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow: hidden;
            animation: slideUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .assign-modal-header {
            padding: 24px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .assign-modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .assign-modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .assign-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .assign-modal-body {
            padding: 24px;
            max-height: calc(90vh - 180px);
            overflow-y: auto;
        }

        .assign-mode-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .assign-mode-btn {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            position: relative;
        }

        .assign-mode-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .assign-mode-btn.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f4ff 0%, #e7eeff 100%);
        }

        .assign-mode-btn.active::before {
            content: 'âœ“';
            position: absolute;
            top: 8px;
            right: 8px;
            background: #667eea;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .assign-mode-icon {
            font-size: 2rem;
        }

        .assign-mode-label {
            font-weight: 600;
            color: #1f2937;
        }

        .student-search-container {
            margin-bottom: 24px;
        }

        .search-input-wrapper {
            position: relative;
        }

        .search-input-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            pointer-events: none;
        }

        .student-search-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .student-search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-results {
            margin-top: 16px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            background: #f9fafb;
        }

        .search-result-item {
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 16px;
            background: white;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item:hover {
            background: #f0f4ff;
            transform: translateX(4px);
        }

        .search-result-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .search-result-info {
            flex: 1;
        }

        .search-result-name {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .search-result-details {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .search-result-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .search-result-badge.occupied {
            background: #fee2e2;
            color: #991b1b;
        }

        .search-result-badge.available {
            background: #d1fae5;
            color: #065f46;
        }

        .assign-loading {
            text-align: center;
            padding: 32px;
            color: #6b7280;
        }

        .assign-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #e5e7eb;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 16px;
        }

        .assign-modal-footer {
            padding: 20px 24px;
            border-top: 1px solid #e5e7eb;
            background: #f9fafb;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .assign-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .assign-btn-cancel {
            background: #e5e7eb;
            color: #374151;
        }

        .assign-btn-cancel:hover {
            background: #d1d5db;
        }

        .assign-btn-confirm {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .assign-btn-confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .assign-btn-confirm:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .admin-assign-notice {
            padding: 16px;
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 12px;
            color: #856404;
            font-size: 0.875rem;
            margin-bottom: 16px;
        }

        /* Filter Toggle Styles */
        .occupancy-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .filter-chip {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .filter-chip:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .filter-chip.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .filter-chip-icon {
            font-size: 1rem;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 640px) {
            .assign-modal {
                max-width: 100%;
                margin: 0;
                border-radius: 16px 16px 0 0;
            }

            .assign-mode-selector {
                grid-template-columns: 1fr;
            }

            .assign-modal-footer {
                flex-direction: column;
            }

            .assign-btn {
                width: 100%;
            }
        }

        #occupancyData::-webkit-scrollbar-track,
        #noiseData::-webkit-scrollbar-track,
        #announcementsList::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }

        #occupancyData::-webkit-scrollbar-thumb,
        #noiseData::-webkit-scrollbar-thumb,
        #announcementsList::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        #occupancyData::-webkit-scrollbar-thumb:hover,
        #noiseData::-webkit-scrollbar-thumb:hover,
        #announcementsList::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Responsive max-height adjustments */
        @media (max-width: 1024px) {

            #occupancyData,
            #noiseData {
                max-height: 400px;
            }

            #announcementsList {
                max-height: 500px;
            }
        }

        @media (max-width: 640px) {

            #occupancyData,
            #noiseData {
                max-height: 300px;
            }

            #announcementsList {
                max-height: 400px;
            }
        }

        /* Quick Guide Button Styling */
        #quickGuideBtn {
            position: fixed !important;
            bottom: 24px !important;
            right: 24px !important;
            top: auto !important;
            z-index: 50 !important;
            background: rgba(255, 255, 255, 0.98) !important;
            /* Removed backdrop-filter for performance */
            border: 2px solid #0e163e !important;
            width: 48px !important;
            height: 48px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            border-radius: 12px !important;
            box-shadow: 0 4px 16px rgba(14, 22, 62, 0.15) !important;
            transition: all 0.3s ease !important;
        }

        #quickGuideBtn:hover {
            background: #0e163e !important;
            transform: translateY(-2px) scale(1.05) !important;
            box-shadow: 0 6px 24px rgba(14, 22, 62, 0.25) !important;
        }

        #quickGuideBtn:hover i {
            color: white !important;
        }

        #quickGuideBtn i {
            transition: color 0.3s ease !important;
            width: 24px !important;
            height: 24px !important;
        }

        #quickGuideBtn:active {
            transform: translateY(0) scale(1) !important;
        }

        [data-page="setup"] .quick-guide-trigger {
            all: unset !important;
            cursor: pointer !important;
        }

        /* Tooltip Popup Styles */
        #quickGuideTooltip {
            position: fixed !important;
            z-index: 100 !important;
            background: white !important;
            border-radius: 16px !important;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15), 0 8px 24px rgba(0, 0, 0, 0.1) !important;
            border: 1px solid rgba(14, 22, 62, 0.1) !important;
            max-width: 420px !important;
            width: 90vw !important;
            max-height: 85vh !important;
            overflow-y: auto !important;
            opacity: 0 !important;
            transform: scale(0.95) translateY(-10px) !important;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
            pointer-events: none !important;
        }

        #quickGuideTooltip.show {
            opacity: 1 !important;
            transform: scale(1) translateY(0) !important;
            pointer-events: all !important;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            #quickGuideTooltip {
                max-width: calc(100vw - 32px) !important;
                width: calc(100vw - 32px) !important;
                max-height: 90vh !important;
                border-radius: 20px !important;
                left: 16px !important;
                right: 16px !important;
                margin: 0 auto !important;
            }

            #quickGuideTooltip .p-6 {
                padding: 1.25rem !important;
            }

            .guide-item {
                padding: 0.875rem !important;
                gap: 0.75rem !important;
                min-height: 60px !important;
            }

            .guide-item h3 {
                font-size: 0.875rem !important;
            }

            .guide-item p {
                font-size: 0.75rem !important;
                line-height: 1.4 !important;
            }

            .guide-item i[data-lucide] {
                min-width: 16px !important;
            }

            #guideDetailView .space-y-4>div {
                padding: 0.875rem !important;
            }

            #guideDetailView h2 {
                font-size: 1.125rem !important;
            }

            #guideDetailView h3 {
                font-size: 0.8125rem !important;
            }

            #guideDetailView p {
                font-size: 0.75rem !important;
                line-height: 1.5 !important;
            }

            #guideDetailView .flex.items-center.gap-3 {
                gap: 0.75rem !important;
            }

            #closeTooltipBtn,
            #closeTooltipBtnDetail {
                min-height: 44px !important;
                min-width: 44px !important;
                padding: 0.75rem !important;
            }

            #backToListBtn {
                min-height: 44px !important;
                padding: 0.625rem 1rem !important;
                font-size: 0.875rem !important;
            }

            #backToListBtn span {
                font-size: 0.875rem !important;
            }
        }

        #quickGuideTooltip::-webkit-scrollbar {
            width: 8px;
        }

        #quickGuideTooltip::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }

        #quickGuideTooltip::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        #quickGuideTooltip::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .tooltip-arrow {
            position: absolute !important;
            width: 12px !important;
            height: 12px !important;
            background: white !important;
            border: 1px solid rgba(14, 22, 62, 0.1) !important;
            border-top: none !important;
            border-left: none !important;
            transform: rotate(45deg) !important;
        }

        .guide-item {
            position: relative !important;
            -webkit-tap-highlight-color: transparent !important;
            touch-action: manipulation !important;
        }

        .guide-item:hover {
            transform: none !important;
        }

        @media (max-width: 768px) {
            .guide-item:active {
                transform: scale(0.98) !important;
                background-color: rgba(14, 22, 62, 0.05) !important;
            }

            .guide-item:hover {
                transform: none !important;
            }
        }

        #guideDetailView {
            animation: fadeIn 0.2s ease-in !important;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(10px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Responsive positioning */
        @media (max-width: 1024px) {
            #quickGuideBtn {
                bottom: 20px !important;
                right: 20px !important;
            }

            #quickGuideTooltip {
                max-width: 380px !important;
            }
        }

        @media (max-width: 768px) {
            #quickGuideBtn {
                bottom: 16px !important;
                right: 16px !important;
                width: 44px !important;
                height: 44px !important;
            }

            #quickGuideBtn i {
                width: 22px !important;
                height: 22px !important;
            }
        }

        /* Force burger menu to be visible and clickable on mobile */
        @media (max-width: 768px) {
            #burgerMenuBtn {
                display: flex !important;
                position: fixed !important;
                top: 1rem !important;
                right: 1rem !important;
                width: 48px !important;
                height: 48px !important;
                min-width: 48px !important;
                min-height: 48px !important;
                z-index: 999999 !important;
                pointer-events: auto !important;
                background: rgba(255, 255, 255, 1) !important;
                border: 2px solid rgba(14, 22, 62, 0.2) !important;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3) !important;
                cursor: pointer !important;
                touch-action: manipulation !important;
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1) !important;
            }

            #burgerMenuBtn .burger-line {
                pointer-events: none !important;
            }
        }

        @media (min-width: 769px) {
            #burgerMenuBtn {
                display: none !important;
            }
        }
    </style>
</head>

<body
    class="text-slate-900 min-h-screen flex flex-col relative setup-body-bg"
    data-page="setup">
    <!-- Visual Effects -->
    <div id="cursor-follower" class="cursor-follower" aria-hidden="true"></div>
    <div id="library-background" class="library-background" aria-hidden="true"></div>
    <div id="paper-background" class="paper-background" aria-hidden="true"></div>

    <style>
        [data-page="setup"] .nav-label {
            left: 250px;
            right: auto;
            top: 25px;
            z-index: 99999;
            /* keep other styles (padding, font, bg, etc.) as is */
        }
    </style>

    <!-- Old navigation hidden for setup page - styles in setup.css -->

    <!-- Old mobile menu system removed - using new sidebar toggle instead -->

    <!-- Modern Layout: Fixed Sidebar + Main Content -->
    <div class="admin-layout-container">
        <!-- Fixed Sidebar (Left) -->
        <aside id="adminSidebar" class="admin-sidebar">
            <div class="sidebar-header">
                <img src="images/UMak_Logo_Registered.png" alt="University of Makati Logo" class="sidebar-logo" />
                <h1 class="sidebar-title">Admin Dashboard</h1>
            </div>
            <nav class="sidebar-nav">
                <a href="setup.html" class="admin-nav-link active" data-label="Admin Dashboard"
                    aria-label="Admin Dashboard">
                    <i data-lucide="settings" class="admin-nav-icon"></i>
                    <span class="admin-nav-text">Dashboard</span>
                </a>
                <a href="user-management.html" class="admin-nav-link" data-label="User Management"
                    aria-label="User Management">
                    <i data-lucide="users" class="admin-nav-icon"></i>
                    <span class="admin-nav-text">Users</span>
                </a>
                <a href="rfid-management.html" class="admin-nav-link" data-label="RFID Management"
                    aria-label="RFID Management">
                    <i data-lucide="contact" class="admin-nav-icon"></i>
                    <span class="admin-nav-text">Devices</span>
                </a>
                <a href="student-reports.html" class="admin-nav-link" data-label="Student Reports"
                    aria-label="Student Reports">
                    <i data-lucide="book-open-check" class="admin-nav-icon"></i>
                    <span class="admin-nav-text">Reports</span>
                </a>
                <a href="activity-logs.html" class="admin-nav-link" data-label="Activity Logs"
                    aria-label="Activity Logs">
                    <i data-lucide="list" class="admin-nav-icon"></i>
                    <span class="admin-nav-text">Activity</span>
                </a>
                <a href="lcd-messages.html" class="admin-nav-link" data-label="LCD Messages" aria-label="LCD Messages">
                    <i data-lucide="tv" class="admin-nav-icon"></i>
                    <span class="admin-nav-text">LCD Messages</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <a href="#" onclick="logout(); return false;" class="admin-nav-link logout-item" data-label="Logout"
                    aria-label="Logout">
                    <i data-lucide="log-out" class="admin-nav-icon"></i>
                    <span class="admin-nav-text">Logout</span>
                </a>
            </div>
        </aside>

        <!-- Main Content Area (Right) -->
        <main class="admin-main-content">
            <!-- Top Navigation Bar -->
            <header class="admin-top-nav">
                <div class="top-nav-left">
                    <button id="sidebarToggle" class="sidebar-toggle-btn" aria-label="Toggle sidebar"
                        aria-expanded="false" aria-controls="adminSidebar">
                        <i data-lucide="menu" class="w-5 h-5"></i>
                    </button>
                    <h1 class="page-title">Admin Dashboard</h1>
                </div>
                <div class="top-nav-right">
                    <div class="top-nav-profile">
                        <div class="profile-avatar">A</div>
                    </div>
                </div>
            </header>

            <!-- Quick Guide Button (Fixed Position) -->
            <button id="quickGuideBtn" class="quick-guide-trigger" aria-label="Toggle Quick Guide"
                title="Show Admin Guide">
                <i data-lucide="help-circle"
                    class="text-gray-400 hover:text-indigo-600 transition-colors cursor-pointer"></i>
                <span id="guideBadge" class="absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full hidden"></span>
            </button>

            <!-- Tooltip Popup -->
            <div id="quickGuideTooltip" class="hidden">
                <div class="tooltip-arrow"></div>
                <div class="p-6">
                    <!-- Main Guide List View -->
                    <div id="guideListView">
                        <div class="flex items-center justify-between mb-5">
                            <h2 class="text-xl font-bold setup-title-color">Admin Navigation Guide</h2>
                            <button id="closeTooltipBtn" class="text-gray-400 hover:text-gray-600 transition-colors p-1"
                                aria-label="Close guide">
                                <i data-lucide="x" class="w-5 h-5"></i>
                            </button>
                        </div>
                        <div class="space-y-3">
                            <div class="guide-item flex items-start gap-3 p-3 bg-indigo-50/50 rounded-lg border border-indigo-100 hover:bg-indigo-50 transition-colors cursor-pointer"
                                data-guide="dashboard">
                                <div class="setup-icon-bg rounded-lg p-2 flex-shrink-0">
                                    <i data-lucide="settings" class="setup-icon-color w-5 h-5"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-semibold setup-title-color mb-1 text-sm">Admin
                                        Dashboard</h3>
                                    <p class="text-xs text-gray-600">View system statistics, manage
                                        announcements,
                                        monitor occupancy and noise levels.</p>
                                </div>
                                <i data-lucide="chevron-right"
                                    class="w-4 h-4 text-gray-400 mt-1"></i>
                            </div>

                            <div class="guide-item flex items-start gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors cursor-pointer"
                                data-guide="users">
                                <div class="bg-gray-200 rounded-lg p-2 flex-shrink-0">
                                    <i data-lucide="users" class="text-gray-700 w-5 h-5"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-900 mb-1 text-sm">User
                                        Management</h3>
                                    <p class="text-xs text-gray-600">Add new users, update
                                        information, change roles,
                                        and manage accounts.</p>
                                </div>
                                <i data-lucide="chevron-right"
                                    class="w-4 h-4 text-gray-400 mt-1"></i>
                            </div>

                            <div class="guide-item flex items-start gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors cursor-pointer"
                                data-guide="devices">
                                <div class="bg-gray-200 rounded-lg p-2 flex-shrink-0">
                                    <i data-lucide="contact" class="text-gray-700"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-900">Device
                                        Management</h3>
                                    <p class="text-xs text-gray-600">Assign and manage access
                                        devices, view status, and
                                        track usage.</p>
                                </div>
                                <i data-lucide="chevron-right"
                                    class="w-4 h-4 text-gray-400"></i>
                            </div>

                            <div class="guide-item flex items-start gap-3 p-3 bg-gray-50"
                                data-guide="reports">
                                <div class="bg-gray-200">
                                    <i data-lucide="book-open-check"
                                        class="text-gray-700"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-900">Student
                                        Reports</h3>
                                    <p class="text-xs text-gray-600">View submitted reports, filter
                                        by status, and
                                        manage responses.</p>
                                </div>
                                <i data-lucide="chevron-right"
                                    class="w-4 h-4 text-gray-400"></i>
                            </div>

                            <div class="guide-item flex items-start gap-3 p-3 bg-gray-50"
                                data-guide="logs">
                                <div class="bg-gray-200">
                                    <i data-lucide="list" class="text-gray-700"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-900">Activity
                                        Logs</h3>
                                    <p class="text-xs text-gray-600">Monitor system activity
                                        including logins, logouts,
                                        and interactions.</p>
                                </div>
                                <i data-lucide="chevron-right"
                                    class="w-4 h-4 text-gray-400"></i>
                            </div>

                            <div class="guide-item flex items-start gap-3 p-3 bg-gray-50"
                                data-guide="lcd">
                                <div class="bg-gray-200">
                                    <i data-lucide="tv" class="text-gray-700"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-900">LCD Messages
                                    </h3>
                                    <p class="text-xs text-gray-600">Configure display messages shown
                                        on physical LCD
                                        screens.</p>
                                </div>
                                <i data-lucide="chevron-right"
                                    class="w-4 h-4 text-gray-400"></i>
                            </div>
                        </div>
                        <div class="mt-5 p-3 bg-blue-50 rounded-lg border border-blue-200">
                            <p class="text-xs text-blue-900">
                                <i data-lucide="info" class="w-3 h-3 inline mr-1.5"></i>
                                <strong>Tip:</strong> Click navigation icons in the sidebar. Use refresh buttons for
                                real-time updates.
                            </p>
                        </div>
                    </div>

                    <!-- Detail View (Hidden by default) -->
                    <div id="guideDetailView" class="hidden">
                        <div class="flex items-center justify-between mb-5">
                            <button id="backToListBtn"
                                class="flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-100"
                                aria-label="Back to list">
                                <i data-lucide="arrow-left" class="w-4 h-4"></i>
                                <span>Back</span>
                            </button>
                            <button id="closeTooltipBtnDetail"
                                class="text-gray-400"
                                aria-label="Close guide">
                                <i data-lucide="x" class="w-5 h-5"></i>
                            </button>
                        </div>
                        <div id="guideDetailContent"></div>
                    </div>
                </div>
            </div>
            <!-- Content Area with CSS Grid -->
            <div id="adminGrid"
                class="admin-content-grid gap-6 p-4 sm:p-6 bg-[#f8f9fa]" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); grid-auto-rows: min-content;">
                <!-- Controls Bar -->
                <div
                    class="col-span-full sticky top-0 z-10 -mx-4 sm:-mx-6 px-4 sm:px-6 py-3 bg-[#f8f9fa]/90">
                    <div class="flex items-center gap-2 text-sm font-medium text-gray-700">
                        <i data-lucide="layout-grid" class="w-4 h-4"></i>
                        <span>Admin Dashboard</span>
                    </div>
                </div>
                <!-- Stats Card -->
                <section
                    class="card-fadein dash-card rounded-2xl shadow-sm hover:shadow-md transition-all p-4 sm:p-6 border border-gray-200" style="grid-column: span 1; min-width: 320px;">
                    <div class="admin-card-header flex items-center justify-between mb-4">
                        <div class="flex items-center gap-2">
                            <i data-lucide="bar-chart-3" class="w-5 h-5 text-indigo-600"></i>
                            <h2 class="text-lg font-semibold setup-title-color">System Overview</h2>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <!-- Total Users Stat -->
                        <div class="group relative overflow-hidden rounded-xl p-5 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 border border-blue-200">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-blue-600">Total Users</p>
                                    <p class="text-3xl font-bold text-blue-900" id="totalUsers">-</p>
                                </div>
                                <div class="w-12 h-12 rounded-lg bg-blue-500/10">
                                    <i data-lucide="users" class="w-6 h-6 text-blue-600"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Access Devices Stat -->
                        <div class="group relative overflow-hidden rounded-xl p-5 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 border border-purple-200">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-purple-600">Access Devices</p>
                                    <p class="text-3xl font-bold text-purple-900" id="totalRfid">-</p>
                                </div>
                                <div class="w-12 h-12 rounded-lg bg-purple-500/10">
                                    <i data-lucide="credit-card" class="w-6 h-6 text-purple-600"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Occupied Seats Stat -->
                        <div class="group relative overflow-hidden rounded-xl p-5 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 border border-green-200">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-green-600">Occupied Seats</p>
                                    <p class="text-3xl font-bold text-green-900" id="occupiedSeats">-</p>
                                </div>
                                <div class="w-12 h-12 rounded-lg bg-green-500/10">
                                    <i data-lucide="armchair" class="w-6 h-6 text-green-600"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Pending Reports Stat -->
                        <div class="group relative overflow-hidden rounded-xl p-5 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 border border-orange-200">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-orange-600">Pending Reports</p>
                                    <p class="text-3xl font-bold text-orange-900" id="pendingReports">-</p>
                                </div>
                                <div class="w-12 h-12 rounded-lg bg-orange-500/10">
                                    <i data-lucide="alert-circle" class="w-6 h-6 text-orange-600"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Table Occupancy Pie Chart -->
                <section
                    class="admin-card card-fadein dash-card bg-white/90" style="grid-column: span 1; min-width: 320px;">
                    <div class="admin-card-header flex items-center gap-2">
                        <i data-lucide="pie-chart" class="w-4 h-4 text-gray-500"></i>
                        <h2 class="text-lg font-semibold setup-title-color">Current Table Occupancy Overview</h2>
                    </div>
                    <p class="text-xs text-gray-600">Real-time occupancy visualization across
                        all tables</p>
                    <div class="flex flex-col items-center justify-center py-6">
                        <div class="w-full max-w-md relative">
                            <canvas id="occupancyPieChart"></canvas>
                            <div id="totalOccupancyLabel"
                                class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center pointer-events-none">
                                <div class="text-3xl font-bold text-gray-900"
                                    id="totalOccupancyPercent">0%</div>
                                <div class="text-xs text-gray-500">Total Occupancy</div>
                            </div>
                        </div>
                        <div id="chartLegend" class="mt-6 w-full max-w-md"></div>
                    </div>
                </section>

                <!-- Noise Card -->
                <section class="admin-card card-fadein dash-card bg-white/90" style="grid-column: 1 / -1;">
                    <div class="admin-card-header mb-6 flex items-center gap-2">
                        <i data-lucide="volume-2" class="w-5 h-5 text-indigo-500"></i>
                        <h2 class="text-lg font-semibold setup-title-color">Noise Monitor</h2>
                    </div>

                    <!-- Table Selector -->
                    <div class="mb-6">
                        <label for="noiseTableSelect" class="block text-sm font-medium text-gray-700">Select Table</label>
                        <select id="noiseTableSelect" onchange="viewNoiseLevel()"
                            class="w-full max-w-xs px-3 py-2 border border-gray-300">
                            <option value="table-1">Table 1</option>
                            <option value="table-2" disabled>Table 2 (Future Expansion)</option>
                            <option value="table-3" disabled>Table 3 (Future Expansion)</option>
                            <option value="table-4" disabled>Table 4 (Future Expansion)</option>
                        </select>
                    </div>

                    <!-- Noise Gauge -->
                    <div id="noiseData" class="mb-8"></div>

                    <!-- Live Noise Alerts -->
                    <div class="mb-8">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-base font-semibold text-gray-900">
                                <i data-lucide="alert-triangle" class="w-4 h-4 text-amber-500"></i>
                                Live Noise Alerts
                            </h3>
                            <div id="noiseAlertsStatus" class="text-xs text-gray-500"></div>
                        </div>
                        <div id="noiseAlertsList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                        <div id="noiseNoAlerts" class="text-sm text-gray-500">
                            <i data-lucide="check-circle" class="w-8 h-8 mx-auto mb-2 text-green-500"></i>
                            No active alerts. All tables are within the threshold.
                        </div>
                    </div>

                    <!-- Noise Alert History -->
                    <div>
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-base font-semibold text-gray-900">
                                <i data-lucide="clock" class="w-4 h-4 text-blue-500"></i>
                                Noise Alert History
                            </h3>
                            <button id="refreshNoiseHistoryBtn"
                                class="px-4 py-2 text-sm rounded-lg bg-gray-100">
                                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                Refresh
                            </button>
                        </div>
                        <div id="noiseAlertHistory" class="space-y-3"></div>
                    </div>
                </section>

                <!-- Occupancy Card -->
                <section class="admin-card card-fadein dash-card bg-white/90" style="grid-column: 1 / -1;">
                    <div class="admin-card-header mb-6 flex items-center gap-2">
                        <i data-lucide="users" class="w-5 h-5 text-emerald-500"></i>
                        <h2 class="text-lg font-semibold setup-title-color">Seat Occupancy</h2>
                    </div>

                    <!-- Table Selector -->
                    <div class="mb-6">
                        <label for="occupancyTableSelect" class="block text-sm font-medium text-gray-700">Select Table</label>
                        <select id="occupancyTableSelect" onchange="viewOccupancy()"
                            class="w-full max-w-xs px-3 py-2 border border-gray-300">
                            <option value="all-tables">Show All Tables</option>
                            <option value="table-1">Table 1</option>
                            <option value="table-2">Table 2</option>
                            <option value="table-3" disabled>Table 3 (Future Expansion)</option>
                            <option value="table-4" disabled>Table 4 (Future Expansion)</option>
                        </select>
                    </div>

                    <!-- Filter Chips -->
                    <div class="flex flex-wrap gap-3 mb-6">
                        <button class="filter-chip active" data-filter="all" onclick="filterSeats('all')">
                            <i data-lucide="clipboard-list" class="w-4 h-4"></i>
                            <span>All Seats</span>
                        </button>
                        <button class="filter-chip" data-filter="student" onclick="filterSeats('student')">
                            <i data-lucide="user" class="w-4 h-4"></i>
                            <span>Students</span>
                        </button>
                        <button class="filter-chip" data-filter="admin" onclick="filterSeats('admin')">
                            <i data-lucide="settings" class="w-4 h-4"></i>
                            <span>Admin Use</span>
                        </button>
                        <button class="filter-chip" data-filter="available" onclick="filterSeats('available')">
                            <i data-lucide="check-circle" class="w-4 h-4"></i>
                            <span>Available</span>
                        </button>
                    </div>

                    <!-- Occupancy Data -->
                    <div id="occupancyData" class="mb-8"></div>

                    <!-- Recent Assignments Section -->
                    <div id="recentAssignments" class="recent-assignments hidden">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-base font-semibold text-gray-900">
                                <i data-lucide="clock" class="w-4 h-4 text-blue-500"></i>
                                Recent Assignments
                            </h3>
                            <button onclick="clearRecentAssignments()" class="px-4 py-2 text-sm rounded-lg bg-gray-100">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                                Clear
                            </button>
                        </div>
                        <div id="recentAssignmentsList" class="space-y-3"></div>
                    </div>
                </section>

                <!-- Statistics Report -->
                <section
                    class="admin-card card-fadein dash-card bg-white/90" style="grid-column: 1 / -1; min-width: 320px;">
                    <div class="admin-card-header flex items-center gap-2">
                        <i data-lucide="bar-chart-3" class="w-5 h-5 text-blue-500"></i>
                        <h2 class="text-lg font-semibold setup-title-color mb-1">Analytics Dashboard</h2>
                    </div>
                    <p class="text-xs text-gray-600">Monitor usage patterns, identify peak times, and track system performance</p>

                    <!-- Key Metrics Summary -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="p-4 rounded-lg border border-blue-200">
                            <div class="flex items-center gap-2 mb-2">
                                <i data-lucide="users" class="w-4 h-4 text-blue-600"></i>
                                <span class="text-sm font-medium text-blue-900">Total Logins</span>
                            </div>
                            <div class="text-2xl font-bold text-blue-900" id="totalLoginsMetric">--</div>
                            <div class="text-xs text-blue-700">This period</div>
                        </div>

                        <div class="p-4 rounded-lg border border-green-200">
                            <div class="flex items-center gap-2 mb-2">
                                <i data-lucide="trending-up" class="w-4 h-4 text-green-600"></i>
                                <span class="text-sm font-medium text-green-900">Peak Hour</span>
                            </div>
                            <div class="text-2xl font-bold text-green-900" id="peakHourMetric">--:--</div>
                            <div class="text-xs text-green-700">Most active time</div>
                        </div>

                        <div class="p-4 rounded-lg border border-purple-200">
                            <div class="flex items-center gap-2 mb-2">
                                <i data-lucide="alert-triangle" class="w-4 h-4 text-purple-600"></i>
                                <span class="text-sm font-medium text-purple-900">Reports</span>
                            </div>
                            <div class="text-2xl font-bold text-purple-900" id="totalReportsMetric">--</div>
                            <div class="text-xs text-purple-700">Student issues</div>
                        </div>

                        <div class="p-4 rounded-lg border border-orange-200">
                            <div class="flex items-center gap-2 mb-2">
                                <i data-lucide="activity" class="w-4 h-4 text-orange-600"></i>
                                <span class="text-sm font-medium text-orange-900">Avg. Session</span>
                            </div>
                            <div class="text-2xl font-bold text-orange-900" id="avgSessionMetric">--m</div>
                            <div class="text-xs text-orange-700">Time per user</div>
                        </div>
                    </div>

                    <!-- Filters and Actions -->
                    <div class="bg-gray-50">
                        <div class="flex flex-col lg:flex-row lg:items-end gap-4 flex-wrap">
                            <div class="flex-1 min-w-[200px]">
                                <label for="statsStartDate" class="block text-sm font-medium text-gray-700">
                                    ðŸ“… Date Range
                                </label>
                                <div class="flex gap-2">
                                    <div>
                                        <label for="statsStartDate" class="block text-xs text-gray-500">From</label>
                                        <input id="statsStartDate" type="date" class="form-input w-full" />
                                    </div>
                                    <div>
                                        <label for="statsEndDate" class="block text-xs text-gray-500">To</label>
                                        <input id="statsEndDate" type="date" class="form-input w-full" />
                                    </div>
                                </div>
                            </div>

                            <div class="flex-1 min-w-[180px]">
                                <label for="statsTableFilter" class="block text-sm font-medium text-gray-700">
                                    ðŸ¢ Filter by Table
                                </label>
                                <select id="statsTableFilter" class="form-input w-full">
                                    <option value="all">ðŸ“Š All Tables</option>
                                    <option value="table-1">ðŸ·ï¸ Table 1</option>
                                    <option value="table-2">ðŸ·ï¸ Table 2</option>
                                    <option value="table-3" disabled>ðŸš§ Table 3 (Future)</option>
                                    <option value="table-4" disabled>ðŸš§ Table 4 (Future)</option>
                                </select>
                            </div>

                            <div class="flex gap-2 flex-wrap">
                                <button id="statsRefreshBtn" class="btn bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2">
                                    <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                    Refresh Data
                                </button>
                                <button id="statsExportCsvBtn" class="btn bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2">
                                    <i data-lucide="download" class="w-4 h-4"></i>
                                    Export CSV
                                </button>
                                <button id="statsPrintBtn" class="btn bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg flex items-center gap-2">
                                    <i data-lucide="printer" class="w-4 h-4"></i>
                                    Print Report
                                </button>
                            </div>
                        </div>

                        <div class="flex items-center justify-between mt-4 pt-4 border-t border-gray-200">
                            <div class="text-sm text-gray-600">
                                ðŸ’¡ <strong>Tip:</strong> Use date filters to analyze specific time periods, or export data for detailed analysis
                            </div>
                            <div class="text-xs text-gray-500 flex items-center gap-2" id="statsLastUpdated">
                                <i data-lucide="clock" class="w-3 h-3"></i>
                                Updated: --
                            </div>
                        </div>
                    </div>

                    <!-- Charts Grid -->
                    <div id="statisticsReport" class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-6">
                        <div class="bg-white">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-sm font-semibold setup-title-color flex items-center gap-2">
                                    <i data-lucide="table" class="w-4 h-4 text-emerald-500"></i>
                                    Table Popularity
                                </h3>
                                <span class="text-xs bg-emerald-100">By Login Count</span>
                            </div>
                            <div class="text-xs text-gray-600">
                                Shows which tables are most frequently used by students
                            </div>
                            <canvas id="topTablesChart" height="250"></canvas>
                        </div>

                        <div class="bg-white">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-sm font-semibold setup-title-color flex items-center gap-2">
                                    <i data-lucide="clock" class="w-4 h-4 text-blue-500"></i>
                                    Usage Patterns
                                </h3>
                                <span class="text-xs bg-blue-100">Hourly Activity</span>
                            </div>
                            <div class="text-xs text-gray-600">
                                Identifies peak hours and low-traffic periods for better resource planning
                            </div>
                            <canvas id="peakHoursChart" height="250"></canvas>
                        </div>

                        <div class="bg-white">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-sm font-semibold setup-title-color flex items-center gap-2">
                                    <i data-lucide="alert-circle" class="w-4 h-4 text-red-500"></i>
                                    Issue Tracker
                                </h3>
                                <span class="text-xs bg-red-100">Problem Types</span>
                            </div>
                            <div class="text-xs text-gray-600">
                                Common problems reported by students - helps prioritize fixes
                            </div>
                            <canvas id="problemsChart" height="250"></canvas>
                        </div>
                    </div>

                    <!-- Actionable Insights -->
                    <div class="p-4 rounded-lg border border-indigo-200">
                        <div class="flex items-center gap-2 mb-3">
                            <i data-lucide="lightbulb" class="w-5 h-5 text-yellow-500"></i>
                            <h4 class="text-sm font-semibold setup-title-color">Key Insights & Recommendations</h4>
                        </div>

                        <div id="statsInsights" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div class="flex items-start gap-3 p-3 bg-white">
                                <div class="w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"></div>
                                <div>
                                    <div class="text-sm font-medium text-gray-900">No activity detected</div>
                                    <div class="text-xs text-gray-600">Check date filters or system connectivity</div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 pt-3 border-t border-indigo-200">
                            <div class="flex items-center gap-2 text-xs text-gray-600">
                                <i data-lucide="info" class="w-3 h-3"></i>
                                <span><strong>ðŸ’¡ Pro Tips:</strong> Monitor peak hours to schedule maintenance, review common issues weekly, and use export feature for detailed trend analysis</span>
                            </div>
                        </div>
                    </div>
                </section>
                </section>

                <!-- Announcements Card -->
                <section
                    class="admin-card card-fadein dash-card bg-white/90" style="grid-column: 1 / -1; min-width: 320px;">
                    <div class="admin-card-header flex items-center gap-2">
                        <i data-lucide="megaphone" class="w-4 h-4 text-gray-500"></i>
                        <h2 class="text-lg font-semibold setup-title-color">Manage Announcements</h2>
                    </div>
                    <p class="text-xs text-gray-600">Create and manage announcements visible to
                        all users</p>

                    <!-- Create New Announcement Form -->
                    <div
                        class="mt-6 p-6 bg-gray-50">
                        <h3 class="text-base font-bold text-gray-900">
                            <i data-lucide="plus-circle" class="w-5 h-5 text-indigo-600"></i>
                            Create New Announcement
                        </h3>
                        <form id="announcementForm" class="space-y-5">
                            <div>
                                <label for="announcementTitle"
                                    class="block text-sm font-semibold text-gray-700">Title</label>
                                <input type="text" id="announcementTitle" required maxlength="100"
                                    placeholder="Enter announcement title..."
                                    class="w-full px-4 py-3 bg-white"
                                    aria-describedby="title-hint">
                            </div>
                            <div>
                                <label for="announcementMessage"
                                    class="block text-sm font-semibold text-gray-700">Message</label>
                                <textarea id="announcementMessage" required rows="4" maxlength="500"
                                    placeholder="Enter announcement message..."
                                    class="w-full px-4 py-3 bg-white"
                                    aria-describedby="char-count-hint"></textarea>
                                <div id="char-count-hint" class="text-xs text-gray-500">
                                    <span id="charCount">0</span> / 500 characters
                                </div>
                            </div>
                            <div class="flex flex-wrap gap-4 py-2">
                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <input type="checkbox" id="announcementPriority"
                                        class="w-4 h-4 rounded border-gray-300">
                                    <span
                                        class="text-sm font-medium text-gray-700">Priority
                                        (highlighted)</span>
                                </label>
                            </div>
                            <div>
                                <label for="announcementExpires"
                                    class="block text-sm font-semibold text-gray-700">Expires At
                                    (Optional)</label>
                                <input type="datetime-local" id="announcementExpires"
                                    class="w-full px-4 py-3 bg-white"
                                    aria-describedby="expires-hint">
                                <div id="expires-hint" class="sr-only">Leave empty for announcement to never
                                    expire</div>
                            </div>
                            <div class="flex gap-3 pt-2">
                                <button type="submit"
                                    class="flex items-center gap-2 px-6 py-3 btn-outline"
                                    aria-label="Post new announcement">
                                    <i data-lucide="send" class="w-4 h-4"></i>
                                    Post Announcement
                                </button>
                                <button type="button" onclick="clearAnnouncementForm()"
                                    class="flex items-center gap-2 px-6 py-3 bg-white"
                                    aria-label="Clear form">
                                    <i data-lucide="x" class="w-4 h-4"></i>
                                    Clear
                                </button>
                            </div>
                            <div id="announcementResult" class="text-sm mt-2"></div>
                        </form>
                    </div>

                    <!-- Existing Announcements List -->
                    <div class="mt-8">
                        <div class="flex items-center justify-between mb-5">
                            <h3 class="text-base font-bold text-gray-900">
                                <i data-lucide="list" class="w-5 h-5 text-indigo-600"></i>
                                Existing Announcements
                            </h3>
                        </div>
                        <div id="announcementsList" class="space-y-3">
                            <p class="text-gray-600">Loading
                                announcements...</p>
                        </div>
                    </div>
                </section>

                <!-- Reports Overview Card -->
                <section
                    class="admin-card card-fadein dash-card bg-white/90" style="grid-column: 1 / -1; min-width: 320px;">
                    <div class="admin-card-header flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <i data-lucide="clipboard-list" class="w-4 h-4 text-gray-500"></i>
                            <h2 class="text-lg font-semibold setup-title-color">Reports Overview</h2>
                            <span id="reportsTotal"
                                class="ml-2 px-2 py-0.5 bg-purple-100">0</span>
                        </div>
                        <div class="text-xs text-gray-500" id="reportsLastUpdated">Loading...</div>
                    </div>
                    <p class="text-xs text-gray-600">Student report submissions by category and
                        time period</p>

                    <!-- Filter Controls -->
                    <div class="flex flex-wrap gap-2 mt-4 mb-6">
                        <button type="button" onclick="filterReportsOverview('today')" class="reports-filter-btn active"
                            data-filter="today">
                            <i data-lucide="calendar-days" class="w-3 h-3"></i>
                            Today
                        </button>
                        <button type="button" onclick="filterReportsOverview('week')" class="reports-filter-btn"
                            data-filter="week">
                            <i data-lucide="calendar-range" class="w-3 h-3"></i>
                            This Week
                        </button>
                        <button type="button" onclick="filterReportsOverview('all')" class="reports-filter-btn"
                            data-filter="all">
                            <i data-lucide="calendar" class="w-3 h-3"></i>
                            All Time
                        </button>
                        <button type="button" onclick="refreshReportsOverview()" class="reports-filter-btn ml-auto"
                            data-filter="refresh">
                            <i data-lucide="refresh-cw" class="w-3 h-3"></i>
                            Refresh
                        </button>
                    </div>

                    <!-- Chart Container -->
                    <div class="p-4 border rounded-lg bg-white">
                        <canvas id="reportsChart" class="max-h-72"></canvas>
                    </div>

                    <!-- Category Breakdown -->
                    <div id="reportsCategoryBreakdown"
                        class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4 mt-6">
                        <div
                            class="text-center p-4 rounded-xl bg-white">
                            <h3 class="text-sm font-semibold text-gray-800">Issues</h3>
                            <p id="issueCount" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                        <div
                            class="text-center p-4 rounded-xl bg-white">
                            <h3 class="text-sm font-semibold text-gray-800">Feedback</h3>
                            <p id="feedbackCount" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                        <div
                            class="text-center p-4 rounded-xl bg-white">
                            <h3 class="text-sm font-semibold text-gray-800">Complaints</h3>
                            <p id="complaintCount" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                        <div
                            class="text-center p-4 rounded-xl bg-white">
                            <h3 class="text-sm font-semibold text-gray-800">Suggestions</h3>
                            <p id="suggestionCount" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                        <div
                            class="text-center p-4 rounded-xl bg-white">
                            <h3 class="text-sm font-semibold text-gray-800">Other</h3>
                            <p id="otherCount" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                    </div>
                </section>
            </div><!-- End of admin-content-grid -->
        </main>
    </div>

    <!-- Student Assignment Modal -->
    <div id="assignModal" class="assign-modal-overlay" style="display:none;" onclick="if(event.target === this) { closeAssignModal(); }" aria-hidden="true">
        <div class="assign-modal">
            <div class="assign-modal-header">
                <h3 id="assignModalTitle">Assign Seat</h3>
                <button class="assign-modal-close" onclick="closeAssignModal()" aria-label="Close modal">
                    Ã—
                </button>
            </div>
            <div class="assign-modal-body">
                <!-- Assignment Mode Selector -->
                <div class="assign-mode-selector">
                    <div class="assign-mode-btn active" data-mode="student" onclick="selectAssignMode('student')">
                        <div class="assign-mode-icon">ðŸ‘¤</div>
                        <div class="assign-mode-label">Assign Student</div>
                    </div>
                    <div class="assign-mode-btn" data-mode="admin" onclick="selectAssignMode('admin')">
                        <div class="assign-mode-icon">ðŸ”§</div>
                        <div class="assign-mode-label">Admin Use</div>
                    </div>
                </div>

                <!-- Student Search Section (visible only in student mode) -->
                <div id="studentSearchSection" class="student-search-container">
                    <div class="search-input-wrapper">
                        <input type="text" id="studentSearchInput" class="student-search-input"
                            placeholder="Search by name or student ID..." oninput="searchStudents(this.value)"
                            autocomplete="off">
                    </div>
                    <div id="searchResults" class="search-results" style="display: none;"></div>
                </div>

                <!-- Admin Assignment Notice (visible only in admin mode) -->
                <div id="adminAssignSection" class="admin-assign-notice" style="display: none;">
                    <strong>âš ï¸ Admin Use Mode</strong>
                    <p style="margin-top: 8px;">This seat will be marked as occupied for administrative purposes
                        (testing, maintenance, or temporary use).</p>
                </div>

                <!-- Selected Student Display -->
                <div id="selectedStudentDisplay"
                    style="display: none; padding: 16px; background: #f0f4ff; border-radius: 12px; border: 2px solid #667eea; margin-bottom: 16px;">
                    <div style="font-weight: 600; color: #000000; margin-bottom: 8px;">Selected Student:</div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div id="selectedStudentAvatar" class="search-result-avatar"></div>
                        <div>
                            <div id="selectedStudentName" style="font-weight: 600; color: #000000;"></div>
                            <div id="selectedStudentDetails" style="font-size: 0.875rem; color: #000000;"></div>
                        </div>
                    </div>
                    <button onclick="clearSelectedStudent()"
                        style="margin-top: 12px; padding: 6px 12px; background: white; border: 1px solid #e5e7eb; border-radius: 6px; cursor: pointer; font-size: 0.875rem; color: #000000;">
                        Change Student
                    </button>
                </div>

                <!-- Loading State -->
                <div id="assignLoading" class="assign-loading" style="display: none;">
                    <div class="assign-spinner"></div>
                    <div>Processing assignment...</div>
                </div>
            </div>
            <div class="assign-modal-footer">
                <button class="assign-btn assign-btn-cancel" onclick="closeAssignModal()">Cancel</button>
                <button id="confirmAssignBtn" class="assign-btn assign-btn-confirm" onclick="confirmAssignment()"
                    disabled>
                    Assign Seat
                </button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="scripts/login-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="scripts/setup.js"></script>
    <script>
        // ============================================
        // ============================================
        document.addEventListener('DOMContentLoaded', function () {
            const html = document.documentElement;

            // Check for saved theme preference or default to light mode
            const currentTheme = localStorage.getItem('theme') || 'light';
            }

            // Wait for Lucide to load, then initialize icons
            let lucideRetries = 0;
            const MAX_RETRIES = 50; // 50 * 100ms = 5 seconds max wait

            function initializeLucideIcons() {
                if (typeof lucide !== 'undefined' && typeof lucide.createIcons === 'function') {
                    lucide.createIcons();
                    console.log('âœ“ Lucide icons initialized (attempt ' + (lucideRetries + 1) + ')');
                } else {
                    lucideRetries++;
                    if (lucideRetries < MAX_RETRIES) {
                        // Lucide not loaded yet, wait 100ms and try again
                        console.log('â³ Waiting for Lucide to load... (attempt ' + lucideRetries + ')');
                        setTimeout(initializeLucideIcons, 100);
                    } else {
                        console.error('âœ— Lucide failed to load after ' + MAX_RETRIES + ' attempts');
                    }
                }
            }
            initializeLucideIcons();

            // Function to update Chart.js charts when theme changes
                if (typeof Chart !== 'undefined' && Chart.instances) {
                    Object.values(Chart.instances).forEach(chart => {
                        if (chart && chart.options) {
                            // Update text colors

                            if (chart.options.scales) {
                                Object.keys(chart.options.scales).forEach(scaleKey => {
                                    const scale = chart.options.scales[scaleKey];
                                    if (scale.ticks) scale.ticks.color = textColor;
                                    if (scale.grid) scale.grid.color = gridColor;
                                });
                            }

                            if (chart.options.plugins && chart.options.plugins.legend) {
                                chart.options.plugins.legend.labels = {
                                    ...chart.options.plugins.legend.labels,
                                    color: textColor
                                };
                            }

                            chart.update();
                        }
                    });
                }
            }

            // Apply initial theme to charts
                setTimeout(() => updateChartsTheme(true), 500);
            }
        });

        // ============================================
        // Sidebar Toggle Functionality + Accessibility
        // ============================================
        document.addEventListener('DOMContentLoaded', function () {
            const sidebarToggle = document.getElementById('sidebarToggle');
            const adminSidebar = document.getElementById('adminSidebar');
            const body = document.body;

            if (sidebarToggle && adminSidebar) {
                sidebarToggle.addEventListener('click', function () {
                    const isOpen = adminSidebar.classList.toggle('sidebar-open');
                    body.classList.toggle('sidebar-open');

                    // Update ARIA attribute for accessibility
                    sidebarToggle.setAttribute('aria-expanded', isOpen.toString());
                });

                // Close sidebar when clicking overlay (mobile)
                body.addEventListener('click', function (e) {
                    if (window.innerWidth <= 768 && body.classList.contains('sidebar-open')) {
                        if (!adminSidebar.contains(e.target) && !sidebarToggle.contains(e.target)) {
                            adminSidebar.classList.remove('sidebar-open');
                            body.classList.remove('sidebar-open');
                            sidebarToggle.setAttribute('aria-expanded', 'false');
                        }
                    }
                });

                // Close sidebar on Escape key (mobile)
                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Escape' && body.classList.contains('sidebar-open')) {
                        adminSidebar.classList.remove('sidebar-open');
                        body.classList.remove('sidebar-open');
                        sidebarToggle.setAttribute('aria-expanded', 'false');
                        sidebarToggle.focus(); // Return focus
                    }
                });
            }

            // Initialize Lucide icons
            if (window.lucide) {
                lucide.createIcons();
            }
        });

        // Add event listener to Refresh Stats button
        const refreshStatsBtn = document.getElementById('refreshStatsBtn');
        if (refreshStatsBtn) {
            refreshStatsBtn.addEventListener('click', async function (e) {
                const btn = e.currentTarget;
                const icon = btn.querySelector('[data-lucide="refresh-cw"]') || btn.querySelector('svg');

                // Visual feedback - spin the icon
                if (icon) {
                    icon.style.animation = 'spin 1s linear infinite';
                }

                try {
                    // Call loadStats from setup.js if it exists
                    if (typeof loadStats === 'function') {
                        await loadStats();
                    } else {
                        // Fallback: directly call Supabase
                        if (!window.supabase) {
                            console.error('Supabase client not available');
                            return;
                        }

                        const SUPABASE_URL = 'https://xnqffcutsadthghqxeha.supabase.co';
                        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhucWZmY3V0c2FkdGhnaHF4ZWhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1NzcwMDMsImV4cCI6MjA3NzE1MzAwM30.wHKLzLhY1q-wGud5Maz3y07sXrkg0JLfY85VF6GGJrk';
                        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

                        // Total users
                        const { count: userCount } = await supabaseClient
                            .from('users')
                            .select('*', { count: 'exact', head: true });

                        // Total access devices
                        const { count: rfidCount } = await supabaseClient
                            .from('rfid_cards')
                            .select('*', { count: 'exact', head: true });

                        // Occupied seats
                        const { count: occupiedCount } = await supabaseClient
                            .from('occupancy')
                            .select('*', { count: 'exact', head: true })
                            .eq('table_id', 'table-1')
                            .eq('is_occupied', true);

                        // Pending reports
                        const { count: pendingCount } = await supabaseClient
                            .from('student_reports')
                            .select('*', { count: 'exact', head: true })
                            .eq('status', 'pending');

                        // Update DOM
                        const totalUsersEl = document.getElementById('totalUsers');
                        const totalRfidEl = document.getElementById('totalRfid');
                        const occupiedSeatsEl = document.getElementById('occupiedSeats');
                        const pendingReportsEl = document.getElementById('pendingReports');

                        if (totalUsersEl) totalUsersEl.textContent = userCount || 0;
                        if (totalRfidEl) totalRfidEl.textContent = rfidCount || 0;
                        if (occupiedSeatsEl) occupiedSeatsEl.textContent = occupiedCount || 0;
                        if (pendingReportsEl) pendingReportsEl.textContent = pendingCount || 0;
                    }
                } catch (err) {
                    console.error('Error loading stats:', err);
                    // Show error on stats
                    const statsElements = ['totalUsers', 'totalRfid', 'occupiedSeats', 'pendingReports'];
                    statsElements.forEach(id => {
                        const el = document.getElementById(id);
                        if (el) el.textContent = 'Error';
                    });
                } finally {
                    // Stop spinning icon
                    if (icon) {
                        icon.style.animation = '';
                    }
                }
            });
        }

        // Keyboard Shortcut - Press ? to open Quick Guide
        document.addEventListener('keydown', function (e) {
            // Only if not typing in an input
            if (e.key === '?' && !e.target.matches('input, textarea, select')) {
                e.preventDefault();
                const guideBtn = document.getElementById('quickGuideBtn');
                if (guideBtn) guideBtn.click();
            }
        });

        // Quick Guide Tooltip Functionality
        document.addEventListener('DOMContentLoaded', function () {
            const quickGuideBtn = document.getElementById('quickGuideBtn');
            const tooltip = document.getElementById('quickGuideTooltip');
            const closeBtn = document.getElementById('closeTooltipBtn');
            const guideBadge = document.getElementById('guideBadge');

            // Function to position tooltip relative to button
            function positionTooltip() {
                if (!quickGuideBtn || !tooltip) return;

                const isMobile = window.innerWidth <= 768;
                const btnRect = quickGuideBtn.getBoundingClientRect();

                if (isMobile) {
                    // Mobile: Center horizontally, position above button
                    const tooltipWidth = window.innerWidth - 32;
                    const left = 16;
                    let top = btnRect.top - (tooltip.offsetHeight || 400) - 12;

                    // If not enough space above, position below
                    if (top < 16 || btnRect.top < (tooltip.offsetHeight || 400) + 20) {
                        top = btnRect.bottom + 12;
                        const arrow = tooltip.querySelector('.tooltip-arrow');
                        if (arrow) {
                            arrow.style.top = '-6px';
                            arrow.style.bottom = 'auto';
                            arrow.style.right = '24px';
                            arrow.style.transform = 'rotate(45deg)';
                        }
                    } else {
                        const arrow = tooltip.querySelector('.tooltip-arrow');
                        if (arrow) {
                            arrow.style.top = 'auto';
                            arrow.style.bottom = '-6px';
                            arrow.style.right = '24px';
                            arrow.style.transform = 'rotate(225deg)';
                        }
                    }

                    // Ensure tooltip doesn't go below viewport
                    const maxTop = window.innerHeight - (tooltip.offsetHeight || 400) - 16;
                    if (top > maxTop) {
                        top = maxTop;
                    }

                    tooltip.style.top = top + 'px';
                    tooltip.style.left = left + 'px';
                    tooltip.style.right = 'auto';
                } else {
                    // Desktop: Position relative to button
                    const tooltipWidth = 420;
                    let top = btnRect.top - (tooltip.offsetHeight || 400) - 12;
                    let left = btnRect.right - tooltipWidth - 16;

                    // Adjust if tooltip would go off-screen to the left
                    if (left < 16) left = 16;
                    // Adjust if tooltip would go off-screen to the right
                    if (left + tooltipWidth > window.innerWidth - 16) {
                        left = window.innerWidth - tooltipWidth - 16;
                    }

                    // Ensure tooltip doesn't go above viewport
                    if (top < 16) {
                        top = 16;
                    }

                    // Arrow always points down (tooltip is above button)
                    const arrow = tooltip.querySelector('.tooltip-arrow');
                    if (arrow) {
                        arrow.style.top = 'auto';
                        arrow.style.bottom = '-6px';
                        arrow.style.right = '24px';
                        arrow.style.transform = 'rotate(225deg)';
                    }

                    tooltip.style.top = top + 'px';
                    tooltip.style.left = left + 'px';
                    tooltip.style.right = 'auto';
                }
            }

            // Function to show tooltip
            function showTooltip() {
                if (!tooltip || !quickGuideBtn) return;

                tooltip.classList.remove('hidden');
                positionTooltip();

                // Trigger animation
                setTimeout(() => {
                    tooltip.classList.add('show');
                }, 10);

                // Update button icon
                const icon = quickGuideBtn.querySelector('i');
                if (icon) {
                    icon.classList.remove('text-gray-400');
                    icon.classList.add('text-indigo-600');
                }

                if (guideBadge) {
                    guideBadge.classList.add('hidden');
                }
            }

            // Function to hide tooltip
            function hideTooltip() {
                if (!tooltip) return;

                tooltip.classList.remove('show');

                setTimeout(() => {
                    tooltip.classList.add('hidden');
                    // Reset to list view when closing
                    showGuideList();
                }, 200);

                // Update button icon
                const icon = quickGuideBtn.querySelector('i');
                if (icon) {
                    icon.classList.remove('text-indigo-600');
                    icon.classList.add('text-gray-400');
                }
            }

            // Toggle tooltip on button click
            if (quickGuideBtn && tooltip) {
                quickGuideBtn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    if (tooltip.classList.contains('show')) {
                        hideTooltip();
                    } else {
                        showTooltip();
                    }
                });
            }

            // Close button
            if (closeBtn) {
                closeBtn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    hideTooltip();
                });
            }

            // Close on Escape key
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape' && tooltip && tooltip.classList.contains('show')) {
                    hideTooltip();
                }
            });

            // Close on outside click
            document.addEventListener('click', function (e) {
                if (tooltip && tooltip.classList.contains('show')) {
                    if (!tooltip.contains(e.target) && !quickGuideBtn.contains(e.target)) {
                        hideTooltip();
                    }
                }
            });

            // Debounce utility for performance optimization
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            // Reposition on window resize (debounced for performance)
            window.addEventListener('resize', debounce(function () {
                if (tooltip && tooltip.classList.contains('show')) {
                    positionTooltip();
                }
            }, 150));

            // Reposition on scroll (throttled for performance)
            let scrollTimeout;
            window.addEventListener('scroll', function () {
                if (!scrollTimeout && tooltip && tooltip.classList.contains('show')) {
                    scrollTimeout = setTimeout(() => {
                        positionTooltip();
                        scrollTimeout = null;
                    }, 100);
                }
            }, { passive: true });

            // Detailed guide content
            const guideDetails = {
                dashboard: {
                    title: 'Admin Dashboard',
                    icon: 'settings',
                    description: 'The main control center for managing the Noise Comfort Index system.',
                    sections: [
                        {
                            title: 'System Statistics',
                            content: 'View real-time statistics including total users, registered devices, occupied seats, and pending reports. Use the Refresh Stats button to update the data.'
                        },
                        {
                            title: 'Seat Occupancy',
                            content: 'Monitor seat occupancy across different tables. Select a table from the dropdown menu and click Refresh to see current occupancy status.'
                        },
                        {
                            title: 'Current Noise Level',
                            content: 'Track noise levels in real-time. Select a table to view current noise measurements and comfort indices.'
                        },
                        {
                            title: 'Manage Announcements',
                            content: 'Create and manage system-wide announcements. Set priority flags, expiration dates, and view all active announcements.'
                        }
                    ]
                },
                users: {
                    title: 'User Management',
                    icon: 'users',
                    description: 'Manage all user accounts, roles, and permissions in the system.',
                    sections: [
                        {
                            title: 'Add New Users',
                            content: 'Click "Add User" to create new accounts. Fill in all required fields including email, name, college department, and assign user roles.'
                        },
                        {
                            title: 'Edit User Information',
                            content: 'Click the edit icon next to any user to update their information, change roles, or modify account settings.'
                        },
                        {
                            title: 'User Roles',
                            content: 'Assign roles: Admin (full access), User (standard access), or custom roles with specific permissions.'
                        },
                        {
                            title: 'Search and Filter',
                            content: 'Use the search bar to find specific users by name or email. Filter by college department or role for easier management.'
                        }
                    ]
                },
                devices: {
                    title: 'Device Management',
                    icon: 'contact',
                    description: 'Register and manage access devices for users.',
                    sections: [
                        {
                            title: 'Register New Device',
                            content: 'Enter the Device ID (from the physical device) and assign it to a user. Each device can only be assigned to one user at a time.'
                        },
                        {
                            title: 'View Device Status',
                            content: 'See all registered devices, their assigned users, and current status (active/inactive).'
                        },
                        {
                            title: 'Unassign Devices',
                            content: 'Click the unassign button to remove device assignments. The device will be available for reassignment.'
                        },
                        {
                            title: 'Device History',
                            content: 'View usage history and activity logs for each registered device to track system interactions.'
                        }
                    ]
                },
                reports: {
                    title: 'Student Reports',
                    icon: 'book-open-check',
                    description: 'Review and manage reports submitted by students.',
                    sections: [
                        {
                            title: 'View Reports',
                            content: 'Browse all submitted reports with details including student information, issue type, description, and timestamp.'
                        },
                        {
                            title: 'Filter by Status',
                            content: 'Filter reports by status: Pending, In Progress, Resolved, or Closed. Use the status dropdown to narrow your view.'
                        },
                        {
                            title: 'Respond to Reports',
                            content: 'Click on a report to view full details and add responses. Update the status as you work through resolving issues.'
                        },
                        {
                            title: 'Report Analytics',
                            content: 'View statistics on report types, response times, and resolution rates to identify common issues and improve service.'
                        }
                    ]
                },
                logs: {
                    title: 'Activity Logs',
                    icon: 'list',
                    description: 'Monitor all system activity and user interactions.',
                    sections: [
                        {
                            title: 'Real-time Logs',
                            content: 'View live activity logs including logins, logouts, device interactions, and system events as they occur.'
                        },
                        {
                            title: 'Filter Options',
                            content: 'Filter logs by date range, user, device, or activity type. Use the search function to find specific events.'
                        },
                        {
                            title: 'Export Logs',
                            content: 'Export activity logs to CSV or PDF format for record-keeping, auditing, or analysis purposes.'
                        },
                        {
                            title: 'Log Retention',
                            content: 'System automatically retains logs for a specified period. Contact system administrator for retention policy details.'
                        }
                    ]
                },
                lcd: {
                    title: 'LCD Messages',
                    icon: 'tv',
                    description: 'Configure messages displayed on physical LCD screens throughout the facility.',
                    sections: [
                        {
                            title: 'Create Messages',
                            content: 'Compose messages that will be displayed on LCD screens. Set priority levels and display duration for each message.'
                        },
                        {
                            title: 'Screen Assignment',
                            content: 'Assign messages to specific LCD screens or broadcast to all screens simultaneously.'
                        },
                        {
                            title: 'Message Scheduling',
                            content: 'Schedule messages to appear at specific times or set them to display immediately. Set expiration dates for automatic removal.'
                        },
                        {
                            title: 'Message Templates',
                            content: 'Save frequently used messages as templates for quick reuse. Customize templates with variables for dynamic content.'
                        }
                    ]
                }
            };

            // Function to show detail view
            function showGuideDetail(guideKey) {
                const detail = guideDetails[guideKey];
                if (!detail) return;

                const detailView = document.getElementById('guideDetailView');
                const listView = document.getElementById('guideListView');
                const detailContent = document.getElementById('guideDetailContent');

                if (!detailView || !listView || !detailContent) return;

                // Hide list view, show detail view
                listView.classList.add('hidden');
                detailView.classList.remove('hidden');

                // Build detail content HTML
                let html = `
                    <div class="mb-4">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="setup-icon-bg rounded-lg p-2">
                                <i data-lucide="${detail.icon}" class="setup-icon-color w-6 h-6"></i>
                            </div>
                            <div>
                                <h2 class="text-xl font-bold setup-title-color">${detail.title}</h2>
                                <p class="text-sm text-gray-600 mt-1">${detail.description}</p>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-4">
                `;

                detail.sections.forEach((section, index) => {
                    html += `
                        <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                            <h3 class="font-semibold text-gray-900 mb-2 text-sm flex items-center gap-2">
                                <span class="w-6 h-6 rounded-full bg-indigo-100 text-indigo-700 flex items-center justify-center text-xs font-bold">${index + 1}</span>
                                ${section.title}
                            </h3>
                            <p class="text-xs text-gray-600 leading-relaxed">${section.content}</p>
                        </div>
                    `;
                });

                html += '</div>';

                detailContent.innerHTML = html;

                // Reinitialize Lucide icons for new content
                if (window.lucide) {
                    lucide.createIcons();
                }

                // Reposition tooltip after content change
                if (tooltip.classList.contains('show')) {
                    positionTooltip();
                }
            }

            // Function to show list view
            function showGuideList() {
                const detailView = document.getElementById('guideDetailView');
                const listView = document.getElementById('guideListView');

                if (detailView && listView) {
                    detailView.classList.add('hidden');
                    listView.classList.remove('hidden');

                    // Reposition tooltip
                    if (tooltip.classList.contains('show')) {
                        positionTooltip();
                    }
                }
            }

            // Add click handlers to guide items
            document.querySelectorAll('.guide-item').forEach(item => {
                item.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const guideKey = this.getAttribute('data-guide');
                    if (guideKey) {
                        showGuideDetail(guideKey);
                    }
                });
            });

            // Back to list button
            const backToListBtn = document.getElementById('backToListBtn');
            if (backToListBtn) {
                backToListBtn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    showGuideList();
                });
            }

            // Close button in detail view
            const closeBtnDetail = document.getElementById('closeTooltipBtnDetail');
            if (closeBtnDetail) {
                closeBtnDetail.addEventListener('click', function (e) {
                    e.stopPropagation();
                    hideTooltip();
                    showGuideList(); // Reset to list view
                });
            }

            // Initialize Lucide icons
            if (window.lucide) {
                lucide.createIcons();
            }
        });
    </script>
</body>

</html>
